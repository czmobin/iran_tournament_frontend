name: Deploy to Server

on:
  push:
    branches:
      - main  # Ù‡Ø±ÙˆÙ‚Øª Ø¨Ù‡ main Ù…Ø±Ø¬ Ø´Ø¯
  workflow_dispatch:  # Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ

jobs:
  deploy:
    name: Deploy to Production Server
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy to Server via SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USERNAME }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: ${{ secrets.SERVER_PORT || 22 }}
          script: |
            set -e

            echo "ğŸš€ Starting deployment process..."

            # Ø±ÙØªÙ† Ø¨Ù‡ Ù¾ÙˆØ´Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡
            cd ${{ secrets.PROJECT_PATH || '/home/user/iran_tournament_frontend' }}

            # Ø¯Ø±ÛŒØ§ÙØª Ø¢Ø®Ø±ÛŒÙ† ØªØºÛŒÛŒØ±Ø§Øª
            echo "ğŸ“¥ Pulling latest changes..."
            git fetch origin
            git reset --hard origin/main

            # Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¯ÛŒÙ¾Ù„ÙˆÛŒ
            echo "ğŸ”„ Running deployment script..."
            chmod +x ./deploy-production.sh
            ./deploy-production.sh

            echo "âœ… Deployment completed successfully!"

      - name: Deployment Status
        if: always()
        run: |
          if [ ${{ job.status }} == 'success' ]; then
            echo "âœ… Deployment succeeded!"
          else
            echo "âŒ Deployment failed!"
            exit 1
          fi
